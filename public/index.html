<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CFW Monitor</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3Eâš¡%3C/text%3E%3C/svg%3E">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        :root { 
            --primary: #F38020;    /* Cloudflare Orange */
            --secondary: #6366f1;  /* Traffic Indigo */
            --bg: #f8fafc; 
            --card-bg: #ffffff; 
            --text-main: #1e293b; 
            --text-sub: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --btn-bg: #fff;
            --btn-hover: #f1f5f9;
        }
        
        [data-theme="dark"] {
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-sub: #94a3b8;
            --border: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --btn-bg: #1e293b;
            --btn-hover: #334155;
        }
        
        * { box-sizing: border-box; transition: background-color 0.3s, color 0.3s, border-color 0.3s; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background: var(--bg); 
            color: var(--text-main); 
            margin: 0; 
            padding: 20px; 
            line-height: 1.5;
        }
        
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* Header Styling */
        .header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 24px; 
            padding: 10px 0;
        }
        .header h1 { 
            margin: 0; 
            font-size: 24px; 
            font-weight: 700;
            display: flex; 
            align-items: center; 
            gap: 10px; 
            letter-spacing: -0.5px;
        }
        
        .header-right { display: flex; align-items: center; gap: 12px; }
        
        .last-update { 
            font-size: 12px; 
            color: var(--text-sub); 
            background: var(--card-bg); 
            border: 1px solid var(--border);
            padding: 6px 12px; 
            border-radius: 99px; 
            font-weight: 500;
        }
        
        /* ä¼˜åŒ–åçš„åœ†å½¢æŒ‰é’®æ ·å¼ */
        .icon-btn {
            background: var(--card-bg);
            border: 1px solid var(--border);
            color: var(--text-main); /* å¼ºåˆ¶ä½¿ç”¨ä¸»é¢˜æ–‡å­—é¢œè‰²ï¼Œè§£å†³æ·±è‰²æ¨¡å¼çœ‹ä¸æ¸…çš„é—®é¢˜ */
            width: 38px; height: 38px; /* ç¨å¾®åŠ å¤§ä¸€ç‚¹å°ºå¯¸ */
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600; /* åŠ ç²—å­—ä½“ */
            box-shadow: var(--shadow);
            user-select: none;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .icon-btn:hover { 
            transform: translateY(-2px); 
            background: var(--btn-hover); 
            border-color: var(--primary); /* æ‚¬åœæ—¶è¾¹æ¡†å˜è‰² */
            color: var(--primary);       /* æ‚¬åœæ—¶æ–‡å­—å˜è‰² */
            box-shadow: 0 4px 12px rgba(243, 128, 32, 0.15); /* æ·»åŠ å½©è‰²é˜´å½± */
        }
        
        /* è¯­è¨€æŒ‰é’®å¾®è°ƒï¼Œç¨å¾®å®½ä¸€ç‚¹å¯èƒ½æ›´å¥½çœ‹ï¼Œè¿™é‡Œä¿æŒåœ†å½¢ä½†ä¼˜åŒ–å­—ä½“ */
        #lang-toggle { font-family: "Segoe UI", sans-serif; }

        /* Card Common Styles */
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        /* Quota Card */
        .quota-card { margin-bottom: 24px; position: relative; overflow: hidden; }
        .quota-card::before {
            content: "";
            position: absolute; left: 0; top: 0; bottom: 0; width: 4px;
            background: var(--primary);
        }
        .quota-header { display: flex; justify-content: space-between; margin-bottom: 12px; font-weight: 600; font-size: 15px; }
        .progress-bg { 
            height: 12px; 
            background: var(--btn-hover); 
            border-radius: 6px; 
            overflow: hidden; 
        }
        .progress-bar { 
            height: 100%; 
            background: linear-gradient(90deg, #F38020, #fbbf24); 
            width: 0%; 
            transition: width 1s ease; 
            border-radius: 6px; 
        }
        .quota-text { 
            display: flex; justify-content: space-between; 
            font-size: 13px; color: var(--text-sub); margin-top: 8px; 
        }

        /* Controls */
        .controls { display: flex; gap: 8px; margin-bottom: 20px; }
        .btn { 
            border: 1px solid var(--border); 
            background: var(--btn-bg); 
            padding: 8px 16px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 13px; 
            font-weight: 500;
            color: var(--text-sub); 
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .btn:hover { background: var(--btn-hover); color: var(--text-main); }
        .btn.active { 
            background: var(--primary); 
            color: white; 
            border-color: var(--primary);
            box-shadow: 0 2px 4px rgba(243, 128, 32, 0.3);
        }

        /* Stats Grid */
        .grid { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 16px; 
            margin-bottom: 24px; 
        }
        .stat-card { padding: 20px; }
        .stat-title { 
            color: var(--text-sub); 
            font-size: 12px; 
            font-weight: 600;
            margin-bottom: 8px; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
        }
        .stat-value { 
            font-size: 24px; 
            font-weight: 700; 
            color: var(--text-main); 
            letter-spacing: -0.5px;
        }
        .text-green { color: var(--secondary); } 
        .text-red { color: #ef4444; }

        /* Chart */
        #chart-container { height: 420px; padding: 20px; }

        /* Responsive */
        @media (max-width: 768px) {
            .grid { grid-template-columns: repeat(2, 1fr); }
            .header h1 { font-size: 20px; }
        }
        @media (max-width: 480px) {
            .grid { grid-template-columns: 1fr; }
            .controls { overflow-x: auto; padding-bottom: 4px; }
            .btn { white-space: nowrap; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><span style="color: var(--primary)">âš¡</span> <span data-i18n="title">Worker ç›‘æ§</span></h1>
            <div class="header-right">
                <span id="update-time" class="last-update" data-i18n="loading">è½½å…¥ä¸­...</span>
                <button id="lang-toggle" class="icon-btn" onclick="toggleLanguage()" title="åˆ‡æ¢è¯­è¨€">En</button>
                <button id="theme-toggle" class="icon-btn" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
            </div>
        </div>

        <div class="card quota-card">
            <div class="quota-header">
                <span data-i18n="quota_title">ä»Šæ—¥è¯·æ±‚ç”¨é‡ (UTC)</span>
                <span id="quota-percent">0%</span>
            </div>
            <div class="progress-bg">
                <div id="quota-bar" class="progress-bar"></div>
            </div>
            <div class="quota-text">
                <span id="quota-detail">0 / 100,000</span>
                <span data-i18n="quota_reset">é‡ç½®æ—¶é—´: 00:00 UTC</span>
            </div>
        </div>

        <div class="controls">
            <button class="btn active" onclick="setRange('24h')" data-i18n="btn_24h">æœ€è¿‘ 24 å°æ—¶</button>
            <button class="btn" onclick="setRange('7d')" data-i18n="btn_7d">æœ€è¿‘ 7 å¤©</button>
            <button class="btn" onclick="setRange('30d')" data-i18n="btn_30d">æœ€è¿‘ 30 å¤©</button>
        </div>

        <div class="grid">
            <div class="card stat-card">
                <div class="stat-title" data-i18n="stat_req">åŒºé—´æ€»è¯·æ±‚æ•°</div>
                <div class="stat-value" id="disp-req">-</div>
            </div>
            <div class="card stat-card">
                <div class="stat-title" data-i18n="stat_traffic">åŒºé—´æ€»æµé‡</div>
                <div class="stat-value text-green" id="disp-traffic">-</div>
            </div>
            <div class="card stat-card">
                <div class="stat-title" data-i18n="stat_err">åŒºé—´é”™è¯¯æ•°</div>
                <div class="stat-value text-red" id="disp-err">-</div>
            </div>
            <div class="card stat-card">
                <div class="stat-title" data-i18n="stat_avg">å¹³å‡æ¯å°æ—¶è¯·æ±‚</div>
                <div class="stat-value" id="disp-avg">-</div>
            </div>
        </div>

        <div id="chart-container" class="card"></div>
    </div>

    <script>
        // ==========================================
        // 0. I18n System (å¤šè¯­è¨€ç³»ç»Ÿ)
        // ==========================================
        var currentLang = 'zh'; // é»˜è®¤ä¸­æ–‡
        
        const translations = {
            zh: {
                title: "Cloudflare Worker ç›‘æ§",
                loading: "è½½å…¥ä¸­...",
                update_prefix: "æ›´æ–°äº: ",
                update_fail: "åŒæ­¥å¤±è´¥",
                quota_title: "ä»Šæ—¥è¯·æ±‚ç”¨é‡ (UTC)",
                quota_reset: "é‡ç½®æ—¶é—´: 00:00 UTC",
                btn_24h: "æœ€è¿‘ 24 å°æ—¶",
                btn_7d: "æœ€è¿‘ 7 å¤©",
                btn_30d: "æœ€è¿‘ 30 å¤©",
                stat_req: "åŒºé—´æ€»è¯·æ±‚æ•°",
                stat_traffic: "åŒºé—´æ€»æµé‡",
                stat_err: "åŒºé—´é”™è¯¯æ•°",
                stat_avg: "å¹³å‡æ¯å°æ—¶è¯·æ±‚",
                chart_title: "è¯·æ±‚ä¸æµé‡è¶‹åŠ¿",
                legend_req: "æ€»è¯·æ±‚",
                legend_traffic: "æµé‡",
                legend_err: "é”™è¯¯",
                lang_btn: "En"
            },
            en: {
                title: "Cloudflare Worker Monitor",
                loading: "Loading...",
                update_prefix: "Updated: ",
                update_fail: "Sync Failed",
                quota_title: "Today's Requests (UTC)",
                quota_reset: "Reset: 00:00 UTC",
                btn_24h: "Last 24 Hours",
                btn_7d: "Last 7 Days",
                btn_30d: "Last 30 Days",
                stat_req: "Total Requests",
                stat_traffic: "Total Traffic",
                stat_err: "Errors",
                stat_avg: "Avg Req/Hour",
                chart_title: "Requests & Traffic Trend",
                legend_req: "Requests",
                legend_traffic: "Traffic",
                legend_err: "Errors",
                lang_btn: "ä¸­"
            }
        };

        function updateLanguageUI() {
            var t = translations[currentLang];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                var key = el.getAttribute('data-i18n');
                if (t[key]) el.innerText = t[key];
            });
            document.getElementById('lang-toggle').innerText = t.lang_btn;
            
            if (chartInstance && currentLabels.length > 0) {
                renderChart(currentLabels, currentReqData, currentErrData, currentTrafficData, currentRange);
            }
            updateTimeDisplay();
        }

        function toggleLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            updateLanguageUI();
        }

        // ==========================================
        // 1. Theme Logic
        // ==========================================
        var currentTheme = getThemeByTime();
        function getThemeByTime() {
            var hour = new Date().getHours();
            return (hour >= 8 && hour < 20) ? 'light' : 'dark';
        }
        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            var toggle = document.getElementById('theme-toggle');
            if (toggle) toggle.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            currentTheme = theme;
        }
        function toggleTheme() {
            var newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
            if (chartInstance && currentLabels.length > 0) {
                renderChart(currentLabels, currentReqData, currentErrData, currentTrafficData, currentRange);
            }
        }
        function scheduleNextSwitch() {
            var now = new Date();
            var hour = now.getHours();
            var nextSwitchTime = new Date(now);
            var targetTheme;
            if (hour < 8) { nextSwitchTime.setHours(8, 0, 0, 0); targetTheme = 'light'; } 
            else if (hour < 20) { nextSwitchTime.setHours(20, 0, 0, 0); targetTheme = 'dark'; } 
            else { nextSwitchTime.setDate(nextSwitchTime.getDate() + 1); nextSwitchTime.setHours(8, 0, 0, 0); targetTheme = 'light'; }
            var msUntilSwitch = nextSwitchTime.getTime() - now.getTime();
            if (msUntilSwitch <= 0) msUntilSwitch = 1000; 
            setTimeout(function() {
                applyTheme(targetTheme);
                if (chartInstance) renderChart(currentLabels, currentReqData, currentErrData, currentTrafficData, currentRange);
                scheduleNextSwitch();
            }, msUntilSwitch);
        }
        applyTheme(currentTheme);
        scheduleNextSwitch();

        // ==========================================
        // 2. Data & Chart Logic
        // ==========================================
        var rawData = [];
        var rawTraffic = [];
        var lastUpdateTimeStr = null;
        var chartInstance = null;
        var currentRange = '24h';
        var currentLabels = [];
        var currentReqData = [];
        var currentErrData = [];
        var currentTrafficData = [];
        var DAILY_LIMIT = 100000;

        function init() {
            refreshData();
            window.addEventListener('resize', () => { if (chartInstance) chartInstance.resize(); });
        }

        function formatBytes(bytes, decimals = 2) {
            if (!+bytes) return '0 B';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
        
        function updateTimeDisplay() {
            var t = translations[currentLang];
            var el = document.getElementById('update-time');
            if (lastUpdateTimeStr) {
                el.innerText = t.update_prefix + lastUpdateTimeStr;
            } else {
                el.innerText = t.loading;
            }
        }

        function refreshData() {
            fetch('./data.json?t=' + new Date().getTime())
                .then(res => {
                    if (!res.ok) throw new Error("HTTP " + res.status);
                    return res.json();
                })
                .then(jsonResponse => {
                    rawData = jsonResponse.data || [];
                    rawTraffic = jsonResponse.traffic || [];

                    if (jsonResponse.updatedAt) {
                        var serverTime = new Date(jsonResponse.updatedAt);
                        lastUpdateTimeStr = serverTime.toLocaleString();
                    }
                    updateTimeDisplay();

                    calculateTodayQuota();
                    setRange(currentRange);
                })
                .catch(err => {
                    console.error(err);
                    var t = translations[currentLang];
                    document.getElementById('update-time').innerText = t.update_fail;
                });
        }

        function calculateTodayQuota() {
            var todayStr = new Date().toISOString().split('T')[0];
            var todayRequests = rawData
                .filter(item => item.dimensions.datetime.startsWith(todayStr))
                .reduce((sum, item) => sum + item.sum.requests, 0);

            var percent = Math.min((todayRequests / DAILY_LIMIT) * 100, 100).toFixed(1);
            document.getElementById('quota-bar').style.width = percent + '%';
            document.getElementById('quota-percent').innerText = percent + '%';
            document.getElementById('quota-detail').innerText = todayRequests.toLocaleString() + ' / ' + DAILY_LIMIT.toLocaleString();
            
            if (percent > 80) document.getElementById('quota-bar').style.backgroundColor = '#ef4444';
            else document.getElementById('quota-bar').style.background = ''; 
        }

        function setRange(range) {
            currentRange = range;
            document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));

            var btns = document.querySelectorAll('.btn');
            if (range === '24h') btns[0].classList.add('active');
            if (range === '7d') btns[1].classList.add('active');
            if (range === '30d') btns[2].classList.add('active');

            var now = new Date();
            var startTime = new Date();

            if (range === '24h') startTime.setTime(now.getTime() - 24 * 60 * 60 * 1000);
            else if (range === '7d') startTime.setDate(now.getDate() - 7);
            else startTime.setDate(now.getDate() - 30);

            var filteredReq = rawData.filter(item => new Date(item.dimensions.datetime) >= startTime);
            var filteredTraffic = rawTraffic.filter(item => new Date(item.dimensions.datetime) >= startTime);
            var map = {}; 

            function getTimeKey(dateStr) {
                var d = new Date(dateStr);
                if (range === '24h') return (d.getMonth() + 1) + '/' + d.getDate() + ' ' + d.getHours() + ':00';
                return d.toISOString().split('T')[0];
            }

            filteredReq.forEach(item => {
                var key = getTimeKey(item.dimensions.datetime);
                if (!map[key]) map[key] = { req: 0, err: 0, bytes: 0 };
                map[key].req += item.sum.requests;
                map[key].err += item.sum.errors;
            });

            filteredTraffic.forEach(item => {
                var key = getTimeKey(item.dimensions.datetime);
                if (!map[key]) map[key] = { req: 0, err: 0, bytes: 0 };
                map[key].bytes += (item.sum.edgeResponseBytes || item.sum.bytes || 0);
            });

            var sortedKeys = Object.keys(map).sort((a, b) => {
                if (range === '24h') {
                    var parseTime = str => {
                        var parts = str.split(' ');
                        var dateParts = parts[0].split('/');
                        var h = parts[1].split(':')[0];
                        var year = new Date().getFullYear();
                        return new Date(year, dateParts[0] - 1, dateParts[1], h).getTime();
                    };
                    return parseTime(a) - parseTime(b);
                }
                return a.localeCompare(b);
            });

            var requests = sortedKeys.map(k => map[k].req);
            var errors = sortedKeys.map(k => map[k].err);
            var traffic = sortedKeys.map(k => map[k].bytes);

            var totalReq = requests.reduce((a, b) => a + b, 0);
            var totalErr = errors.reduce((a, b) => a + b, 0);
            var totalBytes = traffic.reduce((a, b) => a + b, 0);
            
            document.getElementById('disp-req').innerText = totalReq.toLocaleString();
            document.getElementById('disp-err').innerText = totalErr.toLocaleString();
            document.getElementById('disp-traffic').innerText = formatBytes(totalBytes); 

            var avg = sortedKeys.length > 0 ? Math.round(totalReq / sortedKeys.length) : 0;
            document.getElementById('disp-avg').innerText = avg.toLocaleString();

            currentLabels = sortedKeys;
            currentReqData = requests;
            currentErrData = errors;
            currentTrafficData = traffic;

            renderChart(sortedKeys, requests, errors, traffic, currentRange);
        }

        function renderChart(labels, reqData, errData, trafficData, range) {
            if (chartInstance) chartInstance.dispose();
            chartInstance = echarts.init(document.getElementById('chart-container'));

            var t = translations[currentLang];
            var isDark = document.documentElement.getAttribute('data-theme') === 'dark';
            
            var textColor = isDark ? '#94a3b8' : '#64748b';
            // ğŸŸ¢ å…³é”®ä¿®å¤ï¼šæ·±è‰²æ¨¡å¼ä¸‹çš„åˆ†å‰²çº¿é¢œè‰²æ”¹ä¸ºåŠé€æ˜ç™½ï¼Œç¡®ä¿å¯è§ä¸”ä¸åˆºçœ¼
            // æ—§å€¼: #1e293b (å¤ªé»‘ä¸å¯è§) -> æ–°å€¼: rgba(255, 255, 255, 0.08)
            var splitColor = isDark ? 'rgba(255, 255, 255, 0.08)' : '#f1f5f9';
            
            var tooltipBg = isDark ? 'rgba(30, 41, 59, 0.95)' : 'rgba(255, 255, 255, 0.95)';
            var tooltipBorder = isDark ? '#334155' : '#e2e8f0';
            var tooltipText = isDark ? '#f1f5f9' : '#0f172a';

            var option = {
                title: { 
                    text: t.chart_title, 
                    left: '0', 
                    textStyle: { color: isDark ? '#f1f5f9' : '#1e293b', fontSize: 16, fontWeight: 600 } 
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: { type: 'line' }, 
                    backgroundColor: tooltipBg,
                    borderColor: tooltipBorder,
                    textStyle: { color: tooltipText },
                    padding: [12, 16],
                    formatter: function (params) {
                        let res = `<div style="margin-bottom: 8px; font-weight: 600; color:${tooltipText}">${params[0].name}</div>`;
                        params.forEach(item => {
                            let val = item.value;
                            let label = item.seriesName;
                            if (item.seriesIndex === 1) { 
                                val = formatBytes(val, 2); 
                            } else {
                                val = Math.floor(val).toLocaleString(); 
                            }
                            
                            let color = item.color;
                            if(typeof color === 'object') color = color.colorStops ? color.colorStops[0].color : item.color; 

                            res += `
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; min-width: 150px;">
                                <span style="font-size: 12px; color: ${textColor}">
                                    <span style="display:inline-block;margin-right:6px;border-radius:50%;width:8px;height:8px;background-color:${color};"></span>
                                    ${label}
                                </span>
                                <span style="font-weight: 600; font-size: 13px; margin-left: 12px;">${val}</span>
                            </div>`;
                        });
                        return res;
                    }
                },
                legend: { 
                    data: [t.legend_req, t.legend_traffic, t.legend_err], 
                    right: 0, 
                    top: 0,
                    textStyle: { color: textColor } 
                },
                grid: { left: '2%', right: '2%', bottom: '5%', top: '15%', containLabel: true },
                xAxis: {
                    type: 'category',
                    data: labels,
                    axisLabel: { 
                        interval: range === '30d' ? 2 : 'auto', 
                        rotate: 0, 
                        color: textColor,
                        fontSize: 11
                    },
                    axisLine: { show: false },
                    axisTick: { show: false }
                },
                yAxis: [
                    {
                        type: 'value',
                        name: t.legend_req, 
                        minInterval: 1,
                        splitLine: { lineStyle: { color: splitColor } },
                        axisLabel: { color: textColor, fontSize: 11 },
                        position: 'left'
                    },
                    {
                        type: 'value',
                        name: t.legend_traffic, 
                        position: 'right',
                        min: 0, 
                        max: function(value) { return value.max > 0 ? value.max * 1.1 : 1024 * 1024; },
                        splitLine: { show: false },
                        axisLabel: { 
                            color: textColor,
                            fontSize: 11,
                            formatter: function(value) { return formatBytes(value, 1); }
                        }
                    }
                ],
                series: [
                    {
                        name: t.legend_req,
                        type: 'line',
                        smooth: true,
                        showSymbol: false,
                        yAxisIndex: 0,
                        data: reqData,
                        lineStyle: { width: 3, color: '#F38020' },
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(243, 128, 32, 0.2)' },
                                { offset: 1, color: 'rgba(243, 128, 32, 0.0)' }
                            ])
                        },
                        itemStyle: { color: '#F38020' }
                    },
                    {
                        name: t.legend_traffic,
                        type: 'line',
                        smooth: true,       
                        showSymbol: false,
                        yAxisIndex: 1,
                        data: trafficData,
                        lineStyle: { width: 3, color: '#6366f1' }, 
                        areaStyle: {        
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(99, 102, 241, 0.2)' },
                                { offset: 1, color: 'rgba(99, 102, 241, 0.0)' }
                            ])
                        },
                        itemStyle: { color: '#6366f1' }
                    },
                    {
                        name: t.legend_err,
                        type: 'bar',
                        yAxisIndex: 0,
                        data: errData,
                        itemStyle: { color: '#ef4444', borderRadius: [4, 4, 0, 0] },
                        barMaxWidth: 20
                    }
                ]
            };
            chartInstance.setOption(option);
        }

        init();
    </script>
</body>
</html>
